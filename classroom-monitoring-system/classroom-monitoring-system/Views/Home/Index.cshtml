@model List<classroom_monitoring_system.Models.User>
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>The site is still on development</p>
    <img src="https://www.demar.eel.usp.br/assets/images/clipart/en-construction.gif" width="60%"/>
</div>

@* <div id="calendar"></div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridDay',
        selectable: true,
        events: [
          { title: 'Reserved', start: '2025-10-04T09:00:00', end: '2025-10-04T11:00:00' },
          { title: 'Reserved', start: '2025-10-04T14:00:00', end: '2025-10-04T15:30:00' }
        ],
        select: function(info) {
          alert("You selected " + info.startStr + " to " + info.endStr);
        }
      });
      calendar.render();
    });
</script> *@

<select id="roomSelect" class="form-select mb-3">
    <option value="101">Room 101</option>
    <option value="102">Room 102</option>
    <option value="103">Room 103</option>
</select>

<div class="mb-3">
    <label>Date</label>
    <input type="date" id="reservationDate" class="form-control">

    <label>Start Time</label>
    <input type="time" id="startTime" class="form-control">

    <label>End Time</label>
    <input type="time" id="endTime" class="form-control">
</div>

<div id="calendar"></div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');

      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridDay',
        selectable: true,
        events: function(fetchInfo, successCallback, failureCallback) {
          var roomId = document.getElementById("roomSelect").value;
          fetch(`/api/reservations?roomId=${roomId}&start=${fetchInfo.startStr}&end=${fetchInfo.endStr}`)
            .then(response => response.json())
            .then(data => successCallback(data))
            .catch(err => failureCallback(err));
        },
        select: function(info) {
          // Fill the inputs when a time range is selected in FullCalendar
          document.getElementById("reservationDate").value = info.startStr.substring(0,10);
          document.getElementById("startTime").value = info.startStr.substring(11,16);
          document.getElementById("endTime").value = info.endStr.substring(11,16);
        }
      });

      calendar.render();

      // Refetch events when room changes
      document.getElementById("roomSelect").addEventListener("change", function () {
        calendar.refetchEvents();
      });

      // Optional: update calendar if user changes inputs manually
      function updateCalendarFromInputs() {
        let date = document.getElementById("reservationDate").value;
        let startTime = document.getElementById("startTime").value;
        let endTime = document.getElementById("endTime").value;

        if (date && startTime && endTime) {
          let start = date + "T" + startTime;
          let end = date + "T" + endTime;

          calendar.removeAllEvents(); // remove temp events
          calendar.refetchEvents();   // reload DB reservations
          calendar.addEvent({
            title: "Your Selection",
            start: start,
            end: end,
            color: "#3788d8"
          });
        }
      }

      document.getElementById("reservationDate").addEventListener("change", updateCalendarFromInputs);
      document.getElementById("startTime").addEventListener("change", updateCalendarFromInputs);
      document.getElementById("endTime").addEventListener("change", updateCalendarFromInputs);
    });
</script>

