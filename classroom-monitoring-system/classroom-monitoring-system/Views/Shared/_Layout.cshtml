@using System.Security.Claims
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@fortawesome/fontawesome-free@@6.7.2/css/fontawesome.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@fortawesome/fontawesome-free@@6.7.2/css/brands.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@fortawesome/fontawesome-free@@6.7.2/css/solid.min.css" />

    <title>@ViewData["Title"] - Classroom Monitoring System</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/taghelper/css/taghelper.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/classroom_monitoring_system.styles.css" asp-append-version="true" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</head>
<body>
    
    <!-- Loading animation -->
    <style>
        /* Centered overlay loader */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
    </style>

    <div id="loadingOverlay">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Second Fingerprint Loader -->
    <div id="loadingOverlay2">
        <div class="fingerprint2"></div>
        <div class="scan-text2">Scanning fingerprint...</div>
    </div>

    <style>
        /* Overlay for second loader */
        #loadingOverlay2 {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* Second fingerprint animation */
        .fingerprint2 {
            width: 120px;
            height: 120px;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #28a745; /* Green for differentiation */
            animation: pulse2 1.5s infinite ease-in-out;
        }

            .fingerprint2::before {
                content: "";
                position: absolute;
                inset: 0;
                background: radial-gradient(circle at center, rgba(40, 167, 69, 0.2) 20%, rgba(40, 167, 69, 0.1) 40%, transparent 70%);
                animation: scan2 2s infinite linear;
            }

        @@keyframes pulse2 {
            0%, 100%

        {
            transform: scale(1);
            opacity: 1;
        }

        50% {
            transform: scale(1.05);
            opacity: 0.7;
        }

        }

        @@keyframes scan2 {
            0%

        {
            transform: translateY(100%) scaleY(0);
        }

        50% {
            transform: translateY(0) scaleY(1);
        }

        100% {
            transform: translateY(-100%) scaleY(0);
        }

        }

        .scan-text2 {
            margin-top: 1rem;
            font-weight: 500;
            color: #28a745;
            font-size: 1.2rem;
        }
    </style>
 
    <!-- Sidebar -->
    @{
        var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
        var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
        var roles = User.FindFirstValue(ClaimTypes.Role);
        var currentUserFullName = User.FindFirstValue(ClaimTypes.Name);
    }
    @if (roles != null)
    {
        <!-- Sidebar Toggle (hamburger button) -->
        <nav class="navbar navbar-dark bg-dark d-md-none">
            <div class="container-fluid">
                <button class="btn btn-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                    <i class="fa-solid fa-bars fs-1"></i>
                </button>
            </div>
        </nav>

        <!-- Sidebar as Offcanvas for mobile -->
        <div class="offcanvas offcanvas-start bg-dark text-white d-md-none" tabindex="-1" id="sidebarMenu">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title">Menu</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a asp-controller="Home" asp-action="Index" class="nav-link text-white @(currentController == "Home" && currentAction == "Index" ? "active" : "")"><i class="fa-regular fa-house"></i> Home</a>
                    </li>
                    <li>
                        <a asp-controller="Home" asp-action="Index" class="nav-link text-white @(currentController == "Clock" && currentAction == "Index" ? "active" : "")"><i class="fa-regular fa-clock"></i> Clock</a>
                    </li>
                    <li>
                        <a asp-controller="User" asp-action="UserListScreen" class="nav-link text-white @(currentController == "User"? "active" : "")"><i class="fa-solid fa-users-gear"></i> Users</a>
                    </li>
                    <li>
                        <a asp-controller="Room" asp-action="RoomListScreen" class="nav-link text-white @(currentController == "Room" ? "active" : "")"><i class="fa-solid fa-school-flag"></i> Room</a>
                    </li>
                    <li>
                        <a asp-controller="Login" asp-action="Logout" class="nav-link text-white"><i class="fa-solid fa-gear"></i> Settings</a>
                    </li>
                    <li>
                        <a asp-controller="Login" asp-action="Logout" class="nav-link text-white"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Sidebar fixed for larger screens -->
        <nav class="sidebar d-none d-md-flex flex-column p-3 bg-dark text-white">
            <a asp-controller="Home" asp-action="Index" class="d-flex justify-content-center align-items-center text-white text-decoration-none p-3">
                <i class="fa-solid fa-bars fs-1"></i>
            </a>
            <hr>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a asp-controller="Home" 
                        asp-action="Index" 
                        title="Dashboard" 
                        class="nav-link @(currentController == "Home" && currentAction == "Index" ? "active" : "")"
                       style="font-size: 2rem; text-align:center"><i class="fa-regular fa-house"></i></a>
                </li>
                <li>
                    <a asp-controller="Attendance" 
                        asp-action="AttendanceListScreen" 
                        title="Attendance" class="nav-link @(currentController == "Attendance"? "active" : "")"
                       style="font-size: 2rem; text-align:center"><i class="fa-regular fa-clock"></i></a>
                </li>
                <li>
                    <a asp-controller="RoomSchedule" 
                        asp-action="RoomScheduleListScreen" 
                        title="Room Schedule" 
                        class="nav-link @(currentController == "RoomSchedule" || currentController == "RoomType" ? "active" : "")"
                       style="font-size: 2rem; text-align:center"><i class="fa-solid fa-calendar"></i></a>
                </li>
                <li>
                    <a asp-controller="User" 
                        asp-action="UserListScreen" 
                        title="Users" 
                        class="nav-link @(currentController == "User" ? "active" : "")"
                       style="font-size: 2rem; text-align:center"><i class="fa-solid fa-users-gear"></i></a>
                </li>
                <li>
                    <a asp-controller="Room" 
                        asp-action="RoomListScreen" 
                        title="Rooms" 
                        class="nav-link @(currentController == "Room" || currentController == "RoomType" ? "active" : "")"
                       style="font-size: 2rem; text-align:center"><i class="fa-solid fa-school-flag"></i></a>
                </li>
            </ul>
            <div class="mt-auto">
                <a asp-controller="Login" asp-action="Logout" class="nav-link" style="font-size: 2rem;">
                    <i class="fa-solid fa-gear"></i>
                </a>
                <a asp-controller="Login" asp-action="Logout" class="nav-link" style="font-size: 2rem; background-color:#f2cc39; color:#707db5; border-radius:50%;margin-bottom:10px;">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </a>
            </div>
        </nav>
    }

    <!-- Loading animation -->

    <!-- Page Content -->
    <div class="content">
        @if (roles != null)
        {
            <img src="~/images/logo.png" style="width:80px;" />
            <hr />
            <div class="row">
                <div class="col col-1 d-flex justify-content-center align-items-center" style="font-size: 3rem;">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="col col-9">
                    <h3>@currentUserFullName</h3>
                    <h5><i>@roles</i></h5>
                </div>
                <div class="col justify-content-end">
                    @{
                        TimeZoneInfo timeZone = TimeZoneInfo.FindSystemTimeZoneById("Asia/Manila");
                        var date = TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, timeZone);
                    }
                    <h5>@date.ToString("MMM d, yyy")</h5>
                    <h5>@date.ToString("dddd")</h5>
                </div>
            </div>
            <hr />
        }
        <div class="container mb-5">
            @RenderBody()
        </div>
        @if (roles != null)
        {
            <footer class="border-top footer text-muted" style="width:80% !important">
                <div class="container-fluid">
                    &copy; 2025 - Classroom Monitoring System - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
                </div>
        
            </footer>
        }
    </div>
</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
        for (var i = 0; i < 10; i++) {
        }
        setTimeout(function () {
            $("div[style='opacity: 0.9; z-index: 2147483647; position: fixed; left: 0px; bottom: 0px; height: 65px; right: 0px; display: block; width: 100%; background-color: #202020; margin: 0px; padding: 0px;']").remove();
            $("div[style='margin: 0px; padding: 0px; left: 0px; width: 100%; height: 65px; right: 0px; bottom: 0px; display: block; position: fixed; z-index: 2147483647; opacity: 0.9; background-color: rgb(32, 32, 32);']").remove();
            $("div[onmouseover='S_ssac();']").remove();
            var somee = $("center").length - 1;
            //$("center")[somee].remove();
            var div_length = document.getElementsByTagName("div").length - 1;
            if ($("div")[div_length].style.height == "65px") $("div")[div_length].remove()
        }, 500);
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach(node => {
            if (node.nodeType === 1) { // element
              // Look for Somee banner by style pattern
              if (node.matches("div[style*='z-index: 2147483647'], div[style*='height: 65px;']")) {
                node.remove();
                console.log("Somee banner removed 🚀");
              }
            }
          });
        });
      });

      // Watch the whole body for new nodes
      observer.observe(document.body, { childList: true, subtree: true });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const link = document.querySelector("center > a[href*='somee.com']");
      if (link) {
        link.parentElement.remove(); // remove the whole <center> tag
        console.log("Somee footer removed 🚀");
      }
    });
</script>